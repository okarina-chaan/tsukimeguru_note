<%
  form_title = local_assigns[:form_title] || "ä»Šæ—¥ã®Daily Note"
  form_subtitle = local_assigns[:form_subtitle] || l(Date.today, format: :long)
  submit_label = local_assigns[:submit_label] || "ä¿å­˜ã™ã‚‹"
  form_url = local_assigns[:form_url]
  form_method = local_assigns[:form_method]
%>

<section class="min-h-screen bg-base-100 text-base-content py-14 px-4">
  <div class="max-w-3xl mx-auto space-y-10">
    <header class="text-center space-y-2">
      <h1 class="text-4xl font-display tracking-widest"><%= form_title %></h1>
      <p class="text-base text-base-content/70"><%= form_subtitle %></p>
    </header>

    <%= form_with model: daily_note,
                  url: form_url,
                  method: form_method,
                  data: { controller: "diary-entry" } do |f| %>

      <% if daily_note.errors.any? %>
        <div class="alert alert-error rounded-xl mb-6">
          <p class="font-semibold mb-2"><%= pluralize(daily_note.errors.count, "ä»¶") %>ã®ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™:</p>
          <ul class="list-disc list-inside text-sm space-y-1">
            <% daily_note.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="space-y-6">
        <div class="card bg-base-200/70 rounded-2xl p-6 border border-base-300/40 space-y-6">
          <h2 class="text-xl font-semibold">ä»Šæ—¥ã®èª¿å­ã¯ã©ã†ï¼Ÿ</h2>

          <div data-diary-entry-target="healthSection" data-group="health">
            <div class="flex justify-between items-center mb-3">
              <span class="text-sm text-base-content/80">ä½“èª¿</span>
              <span class="text-4xl" data-diary-entry-target="healthEmoji">ğŸ˜</span>
            </div>

            <div class="grid grid-cols-5 gap-2">
              <% [1, 2, 3, 4, 5].each do |value| %>
                <button
                  type="button"
                  data-action="click->diary-entry#selectHealth"
                  data-value="<%= value %>"
                  data-group="health"
                  class="score-btn flex flex-col items-center justify-center p-3 rounded-lg border border-base-300 bg-base-100/80 transition"
                >
                  <span class="text-3xl mb-1"><%= %w[ğŸ˜° ğŸ˜” ğŸ˜ ğŸ˜Š ğŸ¥°][value - 1] %></span>
                  <span class="text-xs text-base-content/70"><%= value %></span>
                </button>
              <% end %>
            </div>

            <%= f.hidden_field :condition_score, data: { diary_entry_target: "healthInput" } %>
          </div>

          <div data-diary-entry-target="moodSection" data-group="mood">
            <div class="flex justify-between items-center mb-3">
              <span class="text-sm text-base-content/80">æ°—åˆ†</span>
              <span class="text-4xl" data-diary-entry-target="moodEmoji">ğŸ˜</span>
            </div>

            <div class="grid grid-cols-5 gap-2">
              <% [1, 2, 3, 4, 5].each do |value| %>
                <button
                  type="button"
                  data-action="click->diary-entry#selectMood"
                  data-value="<%= value %>"
                  data-group="mood"
                  class="score-btn flex flex-col items-center justify-center p-3 rounded-lg border border-base-300 bg-base-100/80 transition"
                >
                  <span class="text-3xl mb-1"><%= %w[ğŸ˜° ğŸ˜” ğŸ˜ ğŸ˜Š ğŸ¥°][value - 1] %></span>
                  <span class="text-xs text-base-content/70"><%= value %></span>
                </button>
              <% end %>
            </div>

            <%= f.hidden_field :mood_score, data: { diary_entry_target: "moodInput" } %>
          </div>
        </div>

        <div class="card bg-base-200/70 rounded-2xl p-6 border border-base-300/40 space-y-4">
          <h2 class="text-xl font-semibold">ä»Šæ—¥ã¯ã©ã‚“ãªæ—¥ã ã£ãŸï¼Ÿ</h2>

          <%= f.text_field :did_today,
            placeholder: "ä»Šæ—¥ã‚„ã£ãŸã“ã¨ã¯ï¼Ÿ",
            class: "input input-bordered w-full bg-base-100/80" %>

          <%= f.text_field :try_tomorrow,
            placeholder: "æ˜æ—¥ã‚„ã£ã¦ã¿ãŸã„ã“ã¨ã¯ï¼Ÿ",
            class: "input input-bordered w-full bg-base-100/80" %>

          <div data-diary-entry-target="moreFields" class="hidden space-y-4 pt-2">
            <%= f.text_field :challenge,
              placeholder: "ã†ã¾ãã„ã‹ãªã‹ã£ãŸã“ã¨ã¯ï¼Ÿ",
              class: "input input-bordered w-full bg-base-100/80" %>

            <%= f.text_field :good_things,
              placeholder: "ã‚ˆã‹ã£ãŸã“ã¨ã¯ï¼Ÿ",
              class: "input input-bordered w-full bg-base-100/80" %>
          </div>

          <button
            type="button"
            data-action="click->diary-entry#toggleMore"
            data-diary-entry-target="moreButton"
            class="btn btn-ghost btn-sm w-full text-primary"
          >
            ã‚‚ã£ã¨æ›¸ã â†“
          </button>
        </div>

        <button
          type="button"
          data-action="click->diary-entry#toggleMemo"
          data-diary-entry-target="memoButton"
          class="card bg-base-200/70 rounded-2xl p-6 w-full text-left border border-base-300/40 hover:bg-base-200"
        >
          <span class="text-lg font-semibold flex items-center gap-2 text-primary">
            ãƒ¡ãƒ¢ã‚’è¿½åŠ ã™ã‚‹ +
          </span>
        </button>

        <div data-diary-entry-target="memoArea" class="hidden card bg-base-200/70 rounded-2xl p-6 border border-base-300/40 space-y-3">
          <h2 class="text-lg font-semibold flex items-center gap-2 text-primary">
            ğŸ’¬ ãƒ¡ãƒ¢
          </h2>
          <%= f.text_area :memo,
            rows: 6,
            placeholder: "ä»Šæ—¥æ„Ÿã˜ãŸã“ã¨ã‚„æ°—ã¥ãã‚’è‡ªç”±ã«...",
            class: "textarea textarea-bordered w-full bg-base-100/80" %>
        </div>

        <div class="text-center pt-4">
          <%= f.submit submit_label, class: "btn btn-primary rounded-full px-10" %>
        </div>
      </div>
    <% end %>
  </div>
</section>

<style>
  .score-btn.active {
    border-color: var(--color-primary);
    background-color: color-mix(in srgb, var(--color-primary) 15%, transparent);
  }

  .score-btn.active span:first-child {
    transform: scale(1.1);
  }
</style>
