<section class="min-h-screen bg-base-100 text-base-content py-14 px-4">
  <div class="max-w-4xl mx-auto space-y-10">
    <header class="text-center space-y-3">
      <h1 class="text-4xl font-display tracking-widest">Daily Note一覧</h1>
      <p class="text-base text-base-content/70">これまでの振り返り</p>
    </header>

    <div class="space-y-6">
      <% @daily_notes.each do |note| %>
        <article class="card bg-base-200/70 text-base-content rounded-2xl p-6 border border-base-300/40 shadow-lg">
          <div data-controller="daily-note-toggle">

            <header class="flex flex-col md:flex-row md:items-center md:justify-between gap-3 mb-4">
              <h2 class="text-2xl font-serif"><%= l(note.date, format: :long) %></h2>
              <% if note.moon_phase_name.present? %>
                <span class="text-sm text-primary flex items-center gap-1">
                  🌙 <%= note.moon_phase_name %>
                </span>
              <% end %>
            </header>

            <div class="flex items-center gap-10 mb-4 justify-center">
              <div class="text-center">
                <p class="text-sm uppercase tracking-[0.3em] text-base-content/70">体調</p>
                <p class="text-3xl"><%= %w[😰 😔 😐 😊 🥰][(note.condition_score || 3) - 1] %></p>
              </div>
              <div class="text-center">
                <p class="text-sm uppercase tracking-[0.3em] text-base-content/70">気分</p>
                <p class="text-3xl"><%= %w[😰 😔 😐 😊 🥰][(note.mood_score || 3) - 1] %></p>
              </div>
            </div>

            <button type="button"
                    data-action="click->daily-note-toggle#toggle"
                    data-daily-note-toggle-target="button"
                    class="btn btn-ghost btn-sm w-full text-primary">
              詳細を見る ↓
            </button>

            <div data-daily-note-toggle-target="details" class="hidden mt-4 space-y-3 text-sm leading-relaxed">
              <% if note.did_today.present? %>
                <p class="font-semibold text-primary/80">今日やったこと</p>
                <p class="text-base"><%= note.did_today %></p>
              <% end %>

              <% if note.challenge.present? %>
                <p class="font-semibold text-secondary/80">うまくいかなかったこと</p>
                <p class="text-base"><%= note.challenge %></p>
              <% end %>

              <% if note.good_things.present? %>
                <p class="font-semibold text-accent">よかったこと</p>
                <p class="text-base"><%= note.good_things %></p>
              <% end %>

              <% if note.try_tomorrow.present? %>
                <p class="font-semibold text-secondary/80">明日やってみたいこと</p>
                <p class="text-base"><%= note.try_tomorrow %></p>
              <% end %>

              <% if note.memo.present? %>
                <p class="font-semibold text-primary/80">メモ</p>
                <p class="whitespace-pre-wrap text-base"><%= note.memo %></p>
              <% end %>
            </div>

            <div class="flex flex-col gap-2 mt-5 text-sm font-semibold">
              <div class="text-right">
                <%= link_to edit_daily_note_path(note),
                          class: "btn btn-sm btn-outline btn-primary" do %>
                  編集する
                <% end %>
              </div>

              <div class="text-right">
                <%= link_to daily_note_path(note),
                          data: { turbo_method: :delete, turbo_confirm: "本当にこの日記を削除しますか？" },
                          class: "btn btn-sm btn-outline btn-error" do %>
                  削除する
                <% end %>
              </div>
            </div>

          </div>
        </article>
      <% end %>

      <% if @daily_notes.empty? %>
        <div class="text-center text-sm text-base-content/70">
          まだ日記がありません。
        </div>
      <% end %>
    </div>
  </div>
</section>
