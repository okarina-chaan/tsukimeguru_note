<section class="min-h-screen text-base-content py-10 px-4" style="background-color: #1c1b2f;">
  <header class="text-center mb-10">
    <h1 class="text-3xl font-bold mb-2" style="color: #f6b87e;">ä»Šæ—¥ã®ãƒãƒ¼ãƒˆ</h1>
    <p class="text-sm" style="color: #f4ecd8; opacity: 0.6;">
      <%= l(Date.today, format: :long) %>
    </p>
  </header>

  <div class="max-w-2xl mx-auto space-y-4">
    <%= form_with model: daily_note, url: daily_notes_path, data: { controller: "diary-entry" } do |f| %>

      <% if @daily_note.errors.any? %>
        <div class="alert alert-error rounded-xl p-4 mb-6 text-sm" style="background-color:#f79e9d; color:#2b2020;">
          <p class="font-semibold mb-2"><%= pluralize(@daily_note.errors.count, "ä»¶") %>ã®ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Šã¾ã™:</p>
          <ul class="list-disc list-inside">
            <% @daily_note.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="card shadow-lg p-6 rounded-2xl space-y-6" style="background-color: #2a274e;">
        <h2 class="text-xl font-semibold flex items-center gap-2" style="color: #b19dd5;">
          ä»Šæ—¥ã®èª¿å­ã¯ã©ã†ï¼Ÿ
        </h2>

        <div data-diary-entry-target="healthSection" data-group="health">
          <div class="flex justify-between items-center mb-3">
            <span class="text-sm" style="color: #f4ecd8; opacity: 0.8;">ä½“èª¿</span>
            <span class="text-4xl" data-diary-entry-target="healthEmoji">ğŸ˜</span>
          </div>

          <div class="grid grid-cols-5 gap-2">
            <% [1, 2, 3, 4, 5].each do |value| %>
              <button
                type="button"
                data-action="click->diary-entry#selectHealth"
                data-value="<%= value %>"
                data-group="health"
                class="score-btn flex flex-col items-center justify-center p-3 rounded-lg transition-all border border-base-content border-opacity-10"
                style="background-color: #1c1b2f;"
              >
                <span class="text-3xl mb-1"><%= %w[ğŸ˜° ğŸ˜” ğŸ˜ ğŸ˜Š ğŸ¥°][value - 1] %></span>
                <span class="text-xs" style="color: #f4ecd8; opacity: 0.6;"><%= value %></span>
              </button>
            <% end %>
          </div>

          <%= f.hidden_field :condition_score, data: { diary_entry_target: "healthInput" } %>
        </div>

        <div data-diary-entry-target="moodSection" data-group="mood">
          <div class="flex justify-between items-center mb-3">
            <span class="text-sm" style="color: #f4ecd8; opacity: 0.8;">æ°—åˆ†</span>
            <span class="text-4xl" data-diary-entry-target="moodEmoji">ğŸ˜</span>
          </div>

          <div class="grid grid-cols-5 gap-2">
            <% [1, 2, 3, 4, 5].each do |value| %>
              <button
                type="button"
                data-action="click->diary-entry#selectMood"
                data-value="<%= value %>"
                data-group="mood"
                class="score-btn flex flex-col items-center justify-center p-3 rounded-lg transition-all border border-base-content border-opacity-10"
                style="background-color: #1c1b2f;"
              >
                <span class="text-3xl mb-1"><%= %w[ğŸ˜° ğŸ˜” ğŸ˜ ğŸ˜Š ğŸ¥°][value - 1] %></span>
                <span class="text-xs" style="color: #f4ecd8; opacity: 0.6;"><%= value %></span>
              </button>
            <% end %>
          </div>

          <%= f.hidden_field :mood_score, data: { diary_entry_target: "moodInput" } %>
        </div>
      </div>

      <div class="card shadow-lg p-6 rounded-2xl space-y-4" style="background-color: #2a274e;">
        <h2 class="text-xl font-semibold flex items-center gap-2" style="color: #b19dd5;">
           ä»Šæ—¥ã¯ã©ã‚“ãªæ—¥ã ã£ãŸï¼Ÿ
        </h2>

        <%= f.text_field :did_today, 
          placeholder: "ä»Šæ—¥ã‚„ã£ãŸã“ã¨ã¯ï¼Ÿ",
          class: "w-full text-base px-4 py-3 rounded-lg border focus:outline-none focus:border-opacity-40 transition-colors",
          style: "background-color: #1c1b2f; border-color: #f4ecd8; border-width: 1px; border-opacity: 0.1; color: #f4ecd8;" %>


        <%= f.text_field :try_tomorrow, 
          placeholder: "æ˜æ—¥ã‚„ã£ã¦ã¿ãŸã„ã“ã¨ã¯ï¼Ÿ",
          class: "w-full text-base px-4 py-3 rounded-lg border focus:outline-none focus:border-opacity-40 transition-colors",
          style: "background-color: #1c1b2f; border-color: #f4ecd8; border-width: 1px; border-opacity: 0.1; color: #f4ecd8;" %>

        <div data-diary-entry-target="moreFields" class="hidden space-y-4 pt-2">

          <%= f.text_field :challenge,
            placeholder: "ã†ã¾ãã„ã‹ãªã‹ã£ãŸã“ã¨ã¯ï¼Ÿ",
            class: "w-full text-base px-4 py-3 rounded-lg border focus:outline-none focus:border-opacity-40 transition-colors",
            style: "background-color: #1c1b2f; border-color: #f4ecd8; border-width: 1px; border-opacity: 0.1; color: #f4ecd8;" %>

          <%= f.text_field :good_things, 
          placeholder: "ã‚ˆã‹ã£ãŸã“ã¨ã¯ï¼Ÿ",
          class: "w-full text-base px-4 py-3 rounded-lg border focus:outline-none focus:border-opacity-40 transition-colors",
          style: "background-color: #1c1b2f; border-color: #f4ecd8; border-width: 1px; border-opacity: 0.1; color: #f4ecd8;" %>


        </div>

        <button 
          type="button"
          data-action="click->diary-entry#toggleMore"
          data-diary-entry-target="moreButton"
          class="btn btn-ghost btn-sm w-full transition-colors"
          style="color: #f6b87e;"
        >
          ã‚‚ã£ã¨æ›¸ã â†“
        </button>
      </div>

      <button 
        type="button"
        data-action="click->diary-entry#toggleMemo"
        data-diary-entry-target="memoButton"
        class="card shadow-lg p-6 rounded-2xl w-full text-left hover:bg-opacity-80 transition-colors"
        style="background-color: #2a274e;"
      >
        <span class="text-lg font-semibold flex items-center gap-2" style="color: #b19dd5;">
           ãƒ¡ãƒ¢ã‚’è¿½åŠ ã™ã‚‹ +
        </span>
      </button>

      <div data-diary-entry-target="memoArea" class="hidden card shadow-lg p-6 rounded-2xl space-y-3" style="background-color: #2a274e;">
        <h2 class="text-lg font-semibold flex items-center gap-2" style="color: #b19dd5;">
          ğŸ’¬ãƒ¡ãƒ¢
        </h2>
        <%= f.text_area :memo,
          rows: 6,
          placeholder: "ä»Šæ—¥æ„Ÿã˜ãŸã“ã¨ã‚„æ°—ã¥ãã‚’è‡ªç”±ã«...",
          class: "w-full font-serif text-base px-4 py-3 rounded-lg border focus:outline-none focus:border-opacity-40 transition-colors",
          style: "background-color: #1c1b2f; border-color: #f4ecd8; border-width: 1px; border-opacity: 0.1; color: #f4ecd8;" %>
      </div>

      <div class="mt-6 text-center">
        <%= f.submit "ä¿å­˜ã™ã‚‹", class: "btn btn-primary rounded-full px-8 text-lg", style: "background-color: #b19dd5; color: #1c1b2f;" %>
      </div>
    <% end %>
  </div>
</section>

<style>
  .score-btn.active {
    background-color: rgba(177, 157, 213, 0.2) !important;
    border: 2px solid #b19dd5 !important;
  }
  
  .score-btn.active span:first-child {
    transform: scale(1.1);
  }
</style>
